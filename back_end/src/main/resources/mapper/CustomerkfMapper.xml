<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.model.mapper.CustomerkfMapper">
    <resultMap id="CustomerkfResult" type="com.example.entity.request.Customerkf">
        <id property="customerId" column="customer_id"/>
        <result property="customerTheme" column="customer_theme"/>
        <result property="customerServicelx" column="customer_servicelx"/>
        <result property="customerServicefs" column="customer_servicefs"/>
        <result property="cusId" column="cus_id"/>
        <result property="empId" column="emp_id"/>
        <result property="customerData" column="customer_data"/>
        <result property="customerKhcontacts" column="customer_khcontacts"/>
        <result property="customerState" column="customer_state"/>
        <result property="customerExecutor" column="customer_executor"/>
        <result property="customerServicenr" column="customer_servicenr"/>
        <result property="customerCustomerfk" column="customer_customerfk"/>
    </resultMap>

    <resultMap id="CustomerkfDetailResult" type="com.example.entity.request.Customerkf">
        <id property="customerId" column="customer_id"/>
        <result property="customerTheme" column="customer_theme"/>
        <result property="customerServicelx" column="customer_servicelx"/>
        <result property="customerServicefs" column="customer_servicefs"/>
        <result property="customerData" column="customer_data"/>
        <result property="customerKhcontacts" column="customer_khcontacts"/>
        <result property="customerState" column="customer_state"/>
        <result property="customerExecutor" column="customer_executor"/>
        <result property="customerServicenr" column="customer_servicenr"/>
        <result property="customerCustomerfk" column="customer_customerfk"/>
        <result property="empId" column="emp_id"/>
        <result property="cusId" column="cus_id"/>
        <association property="customerResp" resultMap="CustomerResult"/>
        <association property="empResp" resultMap="EmpResult"/>
    </resultMap>

    <resultMap id="EmpResult" type="com.example.entity.response.EmpResp">
        <id property="empId" column="emp_id"/>
        <result property="empName" column="emp_name"/>
        <result property="nickName" column="nick_name"/>
        <result property="email" column="email"/>
        <result property="sex" column="sex"/>
        <result property="passWord" column="password"/>
        <result property="phone" column="phone"/>
        <result property="empStatus" column="emp_status"/>
        <result property="token" column="token"/>
        <result property="remark" column="remark"/>
        <result property="version" column="version"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
        <result property="isDelete" column="is_delete"/>
    </resultMap>
    
    <resultMap id="ComplaintResult" type="com.example.entity.request.Complaint">
        <id property="complaintId" column="complaint_id"/>
        <result property="complaintZt" column="complaint_complaintzt"/>
        <result property="complaintReceptionist" column="complaint_receptionist"/>
        <result property="complaintClassification" column="complaint_classification"/>
        <result property="complaintDescribe" column="complaint_describe"/>
        <result property="complaintData" column="complaint_data"/>
        <result property="complaintComplainants" column="complaint_complainants"/>
        <result property="complaintUrgent" column="complaint_urgent"/>
        <result property="complaintHandle" column="complaint_handle"/>
        <result property="complaintHandlegc" column="complaint_handlegc"/>
        <result property="complaintCustomerfk" column="complaint_customerfk"/>
        <result property="complaintHfvisit" column="complaint_hfvisit"/>
        <result property="cusId" column="cus_id"/>
        <result property="empId" column="emp_id"/>
    </resultMap>


    <resultMap id="CustomerResult" type="com.example.entity.response.CustomerResp">
        <id column="cus_id" property="cusId"/>
        <result column="cus_name" property="cusName"/>
        <result column="life_cycle" property="lifeCycle"/>
        <result column="first_signing_time" property="firstSigningTime"/>
        <result column="abbreviation" property="abbreviation"/>
        <result column="credit" property="credit"/>
        <result column="settlement" property="settlement"/>
        <result column="company_account" property="companyAccount"/>
        <result column="province" property="province"/>
        <result column="city" property="city"/>
        <result column="detail_address" property="detailAddress"/>
        <result column="cus_remark" property="cusRemark"/>
        <result column="version" property="version"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="is_delete" property="isDelete"/>
        <result column="cus_dict_source" property="cusDictSource"/>
        <result column="cus_dict_stage" property="cusDictStage"/>
        <result column="qualitative_id" property="qualitativeId"/>
        <result column="grading_id" property="gradingId"/>
        <result column="ration_id" property="rationId"/>
        <result column="emp_id" property="empId"/>
    </resultMap>

    <insert id="addCustomerkf" parameterType="com.example.entity.request.Customerkf">
        <selectKey keyProperty="customerId" keyColumn="customer_id" resultType="Integer" order="AFTER">
            SELECT last_insert_id();
        </selectKey>
        insert into customer_service(customer_theme,customer_servicelx,customer_servicefs,customer_data,customer_khcontacts,customer_state,customer_executor,customer_servicenr,customer_customerfk,cus_id,emp_id) VALUES
        (#{customerTheme},#{customerServicelx},#{customerServicefs},#{customerData},#{customerKhcontacts},#{customerState},#{customerExecutor},#{customerServicenr},#{customerCustomerfk},#{cusId},#{empId})
    </insert>

    <update id="updateCustomerkf" parameterType="com.example.entity.request.Customerkf">
        update customer_service set customer_data = #{customerData}
        <if test="customerTheme !=null and customerTheme != ''">
            ,customer_theme = #{customerTheme}
        </if>
        <if test="customerServicelx !=null and customerServicelx != ''">
            ,customer_servicelx = #{customerServicelx}
        </if>
        <if test="customerServicefs !=null and customerServicefs != ''">
            ,customer_servicefs = #{customerServicefs}
        </if>
        <if test="customerKhcontacts !=null and customerKhcontacts != ''">
            ,customer_khcontacts = #{customerKhcontacts}
        </if>
        <if test="customerState !=null and customerState != ''">
            ,customer_state = #{customerState}
        </if>

        <if test="customerExecutor !=null and customerExecutor != ''">
            ,customer_executor = #{customerExecutor}
        </if>
        <if test="customerServicenr !=null and customerServicenr != ''">
            ,customer_servicenr = #{customerServicenr}
        </if>
        <if test="customerCustomerfk !=null and customerCustomerfk != ''">
            ,customer_customerfk = #{customerCustomerfk}
        </if>
        <if test="empId !=null ">
            ,emp_id = #{empId}
        </if>
        where customer_id = #{customerId}
    </update>
    <delete id="deleteCustomerkf" parameterType="Integer">
        DELETE FROM customer_service WHERE customer_id = #{customerId}
    </delete>
    <select id="listCustomerkf" resultMap="CustomerkfDetailResult" parameterType="com.example.entity.request.Customerkf">
        SELECT s.customer_id,s.customer_theme,s.customer_servicelx,s.customer_servicefs,s.customer_data,s.customer_khcontacts,s.customer_state,s.customer_executor,s.customer_servicenr,s.customer_customerfk,
        cu.*,
        e.*
        FROM customer_service s
        left join customer cu on s.cus_id = cu.cus_id
        left join emp e on s.emp_id = e.emp_id
        <where>
            <if test="customerTheme != null and customerTheme != ''">
                AND s.customer_theme LIKE CONCAT('%',#{customerTheme},'%')
            </if>
            <if test="customerServicelx != null and customerServicelx != ''">
                AND s.customer_servicelx LIKE CONCAT('%',#{customerServicelx},'%')
            </if>
            <if test="customerServicefs != null and customerServicefs != ''">
                AND s.customer_servicefs LIKE CONCAT('%',#{customerServicefs},'%')
            </if>
            <if test="customerState != null and customerState != ''">
                AND s.customer_state LIKE CONCAT('%',#{customerState},'%')
            </if>
            <if test="cusId != null">
                and s.cus_id=#{cusId}
            </if>
            <if test="empId != null">
                and s.emp_id=#{empId}
            </if>
        </where>
        ORDER BY customer_data DESC
    </select>
    <select id="getCustomerkf" resultMap="CustomerkfDetailResult">
         SELECT s.*,cu.*,e.*
        FROM customer_service s
        LEFT JOIN customer cu ON cu.cus_id = s.cus_id
         LEFT JOIN emp e ON e.emp_id = s.emp_id
        WHERE s.customer_id = #{customerId}
    </select>
</mapper>