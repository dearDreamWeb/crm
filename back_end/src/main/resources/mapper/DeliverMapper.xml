<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.model.mapper.SzDeliverMapper">
    <resultMap id="szDeliverResult" type="com.example.entity.request.SzDeliver">
        <id property="delId" column="del_id"/>
        <result property="delWuliuid" column="del_wuliuid"/>
        <result property="delCompany" column="del_company"/>
        <result property="delPeople" column="del_people"/>
        <result property="delState" column="del_state"/>
        <result property="delCreatetime" column="del_createtime"/>
        <result property="delDelete" column="del_delete"/>
        <result property="delExpecttime" column="del_expecttime"/>
        <result property="delActualtime" column="del_actualtime"/>
        <result property="ordId" column="ord_id"/>
    </resultMap>

    <resultMap id="szDeliverDetailResult" type="com.example.entity.request.SzDeliver">
        <id property="delId" column="del_id"/>
        <result property="delWuliuid" column="del_wuliuid"/>
        <result property="delCompany" column="del_company"/>
        <result property="delPeople" column="del_people"/>
        <result property="delState" column="del_state"/>
        <result property="delCreatetime" column="del_createtime"/>
        <result property="delDelete" column="del_delete"/>
        <result property="delExpecttime" column="del_expecttime"/>
        <result property="delActualtime" column="del_actualtime"/>
        <association property="szOrder" resultMap="szOrderResult"/>
        <association property="szDeliverDetails" resultMap="DDetailsResult"/>
        <association property="productReq" resultMap="ProductResult"/>
    </resultMap>

    <resultMap id="szOrderResult" type="com.example.entity.request.SzOrder">
        <id property="ordId" column="ord_id"/>
        <result property="ordTheme" column="ord_theme"/>
        <result property="ordState" column="ord_state"/>
        <result property="ordHead" column="ord_head"/>
        <result property="ordTotalmoney" column="ord_totalmoney"/>
        <result property="ordStarttime" column="ord_starttime"/>
        <result property="ordDealtime" column="ord_dealtime"/>
        <result property="ordFahuotime" column="ord_fahuotime"/>
        <result property="ordHuikuanmoney" column="ord_huikuanmoney"/>
        <result property="ordConsignee" column="ord_consignee"/>
        <result property="ordProvince" column="ord_province"/>
        <result property="ordCity" column="ord_city"/>
        <result property="ordCountry" column="ord_country"/>
        <result property="ordDetail" column="ord_detail"/>
        <result property="ordPhone" column="ord_phone"/>
        <result property="ordCreatetime" column="ord_createtime"/>
        <result property="ordDelete" column="ord_delete"/>
    </resultMap>

    <resultMap id="DDetailsResult" type="com.example.entity.request.SzDeliverDetails">
        <id property="ddetId" column="ddet_id"/>
        <result property="ddetNum" column="ddet_num"/>
        <result property="delId" column="del_id"/>
        <result property="productId" column="product_id"/>
    </resultMap>

    <resultMap id="ProductResult" type="com.example.entity.response.ProductResp">
        <id column="product_id" property="productId"/>
        <result column="product_name" property="productName"/>
        <result column="product_image" property="productImage"/>
        <result column="product_model" property="productModel"/>
        <result column="product_price" property="productPrice"/>
        <result column="product_brand" property="productBrand"/>
        <result column="product_stock" property="productStock"/>
        <result column="product_size" property="productSize"/>
        <result column="product_cost" property="productCost"/>
        <result column="product_status" property="productStatus"/>
        <result column="remark" property="remark"/>
        <result column="version" property="version"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="is_delete" property="isDelete"/>
    </resultMap>
    <!--全部 AND d.del_state = 1-->
    <select id="listszDeliver" resultMap="szDeliverDetailResult">
        SELECT d.*,s.*
        FROM sz_deliver d
        LEFT JOIN sz_order s on d.ord_id=s.ord_id
        <where>
            <if test="delWuliuid != null and delWuliuid != ''">
                AND d.del_wuliuid LIKE CONCAT('%',#{delWuliuid},'%')
            </if>
            <if test="delCompany != null and delCompany != ''">
                AND d.del_company LIKE CONCAT('%',#{delCompany},'%')
            </if>
            <if test="delPeople != null and delPeople != ''">
                AND d.del_people LIKE CONCAT('%',#{delPeople},'%')
            </if>
            <if test="delExpecttime != null">
                AND d.del_expecttime LIKE CONCAT('%',#{delExpecttime},'%')
            </if>
            <if test="delActualtime != null">
                AND d.del_actualtime LIKE CONCAT('%',#{delActualtime},'%')
            </if>
            <if test="delState != null">
                AND d.del_state = #{delState}
            </if>
            <if test="ordId != null">
                AND d.ord_id = #{ordId}
            </if>
            <if test="delState != null"><!-- 发货状态 -->
                AND d.del_state= #{delState}
            </if>
            <if test="startDate != null and startDate != ''"><!-- 开始时间检索 -->
                AND date_format(d.del_createtime,'%y%m%d') &gt;= date_format(#{startDate},'%y%m%d')
            </if>
            <if test="endDate != null and endDate != ''"><!-- 结束时间检索 -->
                AND date_format(d.del_createtime,'%y%m%d') &lt;= date_format(#{endDate},'%y%m%d')
            </if>
        </where>
        ORDER BY d.del_createtime DESC
    </select>
    <!--单条-->
    <select id="getszDeliver" resultMap="szDeliverDetailResult" parameterType="Integer">
         SELECT d.*,dd.*,p.*
		 FROM sz_deliver d
		 LEFT JOIN sz_deliver_details dd on d.del_id=dd.del_id
		 LEFT JOIN product p ON dd.product_id=p.product_id
		 WHERE d.del_id= #{delId}
    </select>
    <!--增-->
    <insert id="addszDeliver" parameterType="com.example.entity.request.SzDeliver">
        <selectKey keyColumn="del_id" keyProperty="delId" resultType="Integer" order="AFTER">
            select last_insert_id();
        </selectKey>
        insert into sz_deliver(del_wuliuid, del_company, del_people, del_state, del_createtime,
        del_delete, del_expecttime, del_actualtime, ord_id)
        values (#{delWuliuid},#{delCompany},#{delPeople},#{delState},#{delCreatetime},
        #{delDelete},#{delExpecttime},#{delActualtime},#{ordId})
    </insert>
    <!--删-->
    <update id="delszDeliver" parameterType="Integer">
        UPDATE sz_deliver SET del_delete = 1
        WHERE del_id = #{delId}
    </update>
    <!--改-->
    <update id="editszDeliver" parameterType="com.example.entity.request.SzDeliver">
        UPDATE sz_deliver SET del_createtime = #{delCreatetime}
        <if test="delWuliuid != null and delWuliuid != ''">
            ,del_wuliuid = #{delWuliuid}
        </if>
        <if test="delCompany != null and delCompany != ''">
            ,del_company = #{delCompany}
        </if>
        <if test="delPeople != null and delPeople != ''">
            ,del_people = #{delPeople}
        </if>
        <if test="delDelivertime != null and delDelivertime != ''">
            ,del_delivertime = #{delDelivertime}
        </if>
        <if test="delPeople != null and delPeople != ''">
            ,del_people = #{delPeople}
        </if>
        <if test="delState != null">
            ,del_state = #{delState}
        </if>
        WHERE del_id = #{delId}
    </update>

    <!--新增发货明细时修改发货单-->
    <update id="mx_editszDeliver" parameterType="com.example.entity.request.SzDeliver">
        UPDATE sz_deliver set del_wuliuid = #{delWuliuid},del_company = #{delCompany},del_state=1
        WHERE del_id = #{delId}
    </update>

</mapper>