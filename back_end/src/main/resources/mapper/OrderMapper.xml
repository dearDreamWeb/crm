<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.model.mapper.SzOrderMapper">
    <resultMap id="szOrderResult" type="com.example.entity.request.SzOrder">
    <id property="ordId" column="ord_id"/>
    <result property="ordTheme" column="ord_theme"/>
    <result property="ordState" column="ord_state"/>
    <result property="ordHead" column="ord_head"/>
    <result property="ordTotalmoney" column="ord_totalmoney"/>
    <result property="ordStarttime" column="ord_starttime"/>
    <result property="ordDealtime" column="ord_dealtime"/>
    <result property="ordFahuotime" column="ord_fahuotime"/>
    <result property="ordHuikuanmoney" column="ord_huikuanmoney"/>
    <result property="ordConsignee" column="ord_consignee"/>
    <result property="ordProvince" column="ord_province"/>
    <result property="ordCity" column="ord_city"/>
    <result property="ordCountry" column="ord_country"/>
    <result property="ordDetail" column="ord_detail"/>
    <result property="ordPhone" column="ord_phone"/>
    <result property="ordCreatetime" column="ord_createtime"/>
    <result property="ordDelete" column="ord_delete"/>
    <result property="cusId" column="cus_id"/>
    <result property="offerId" column="offer_id"/>
</resultMap>
    <resultMap id="szOrderDetailResult" type="com.example.entity.request.SzOrder">
        <id property="ordId" column="ord_id"/>
        <result property="ordTheme" column="ord_theme"/>
        <result property="ordState" column="ord_state"/>
        <result property="ordHead" column="ord_head"/>
        <result property="ordTotalmoney" column="ord_totalmoney"/>
        <result property="ordStarttime" column="ord_starttime"/>
        <result property="ordDealtime" column="ord_dealtime"/>
        <result property="ordFahuotime" column="ord_fahuotime"/>
        <result property="ordHuikuanmoney" column="ord_huikuanmoney"/>
        <result property="ordConsignee" column="ord_consignee"/>
        <result property="ordProvince" column="ord_province"/>
        <result property="ordCity" column="ord_city"/>
        <result property="ordCountry" column="ord_country"/>
        <result property="ordDetail" column="ord_detail"/>
        <result property="ordPhone" column="ord_phone"/>
        <result property="ordCreatetime" column="ord_createtime"/>
        <result property="ordDelete" column="ord_delete"/>
        <association property="customerResp" resultMap="CustomerResult"/>
        <association property="SzOrderDetails" resultMap="szDetailsResult"/>
        <association property="SzReceivablePlan" resultMap="szPlanResult"/>
        <association property="szDeliver" resultMap="szDeliverResult"/>
        <association property="productReq" resultMap="ProductResult"/>
    </resultMap>
    <resultMap id="CustomerResult" type="com.example.entity.response.CustomerResp">
        <id column="cus_id" property="cusId"/>
        <result column="cus_name" property="cusName"/>
        <result column="life_cycle" property="lifeCycle"/>
        <result column="first_signing_time" property="firstSigningTime"/>
        <result column="abbreviation" property="abbreviation"/>
        <result column="credit" property="credit"/>
        <result column="settlement" property="settlement"/>
        <result column="company_account" property="companyAccount"/>
        <result column="province" property="province"/>
        <result column="city" property="city"/>
        <result column="detail_address" property="detailAddress"/>
        <result column="cus_remark" property="cusRemark"/>
        <result column="version" property="version"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="is_delete" property="isDelete"/>
        <result column="cus_dict_source" property="cusDictSource"/>
        <result column="cus_dict_stage" property="cusDictStage"/>
        <result column="qualitative_id" property="qualitativeId"/>
        <result column="grading_id" property="gradingId"/>
        <result column="ration_id" property="rationId"/>
        <result column="emp_id" property="empId"/>
    </resultMap>
    <resultMap id="szDetailsResult" type="com.example.entity.request.SzOrderDetails">
        <id property="odetId" column="odet_id"/>
        <result property="odetBuynum" column="odet_buynum"/>
        <result property="odetBuymoney" column="odet_buymoney"/>
        <result property="ordId" column="ord_id"/>
        <result property="productId" column="product_id"/>
    </resultMap>
    <resultMap id="szPlanResult" type="com.example.entity.request.SzReceivablePlan">
        <id property="planId" column="plan_id"/>
        <result property="planMoney" column="plan_money"/>
        <result property="planTime" column="plan_time"/>
        <result property="planPeriod" column="plan_period"/>
        <result property="planCaozuopeople" column="plan_caozuopeople"/>
        <result property="planCaozuotime" column="plan_caozuotime"/>
        <result property="planInvoice" column="plan_invoice"/>
        <result property="planDel" column="plan_del"/>
        <result property="ordId" column="ord_id"/>
        <result property="empId" column="emp_id"/>
    </resultMap>
    <resultMap id="szDeliverResult" type="com.example.entity.request.SzDeliver">
        <id property="delId" column="del_id"/>
        <result property="delWuliuid" column="del_wuliuid"/>
        <result property="delCompany" column="del_company"/>
        <result property="delPeople" column="del_people"/>
        <result property="delDelivertime" column="del_delivertime"/>
        <result property="delState" column="del_state"/>
        <result property="delCreatetime" column="del_createtime"/>
        <result property="delDelete" column="del_delete"/>
        <result property="ordId" column="ord_id"/>
    </resultMap>
    <resultMap id="ProductResult" type="com.example.entity.response.ProductResp">
        <id column="product_id" property="productId"/>
        <result column="product_name" property="productName"/>
        <result column="product_image" property="productImage"/>
        <result column="product_model" property="productModel"/>
        <result column="product_price" property="productPrice"/>
        <result column="product_brand" property="productBrand"/>
        <result column="product_stock" property="productStock"/>
        <result column="product_size" property="productSize"/>
        <result column="product_cost" property="productCost"/>
        <result column="product_status" property="productStatus"/>
        <result column="remark" property="remark"/>
        <result column="version" property="version"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="is_delete" property="isDelete"/>
    </resultMap>

    <!--查全部-->
    <select id="listszOrder" resultMap="szOrderDetailResult">
        SELECT s.*,cl.*
        FROM sz_order s
        left join customer cl on s.cus_id = cl.cus_id
        <where>
            <if test="ordTheme != null and ordTheme != ''">
                AND s.ord_theme LIKE CONCAT('%',#{ordTheme},'%')
            </if>
            <if test="ordHead != null and ordHead != ''">
                AND s.ord_head LIKE CONCAT('%',#{ordHead},'%')
            </if>

            <if test="startDate != null and startDate != ''"><!-- 开始时间检索 -->
                AND date_format(s.ord_starttime,'%y%m%d') &gt;= date_format(#{startDate},'%y%m%d')
            </if>
            <if test="endDate != null and endDate != ''"><!-- 结束时间检索 -->
                AND date_format(s.ord_starttime,'%y%m%d') &lt;= date_format(#{endDate},'%y%m%d')
            </if>

            <if test="ordState != null">
                AND s.ord_state = #{ordState}
            </if>
            <if test="cusId != null">
                and s.cus_id=#{cusId}
            </if>
            and  ord_delete = 0
        </where>
    </select>
    <!--详情查全部-->
    <select id="orderAll" resultMap="szOrderDetailResult">
        SELECT s.*,cl.*,od.*,r.*,p.*
        FROM sz_order s
        left join customer cl on s.cus_id = cl.cus_id
        left join sz_order_details od on s.ord_id=od.ord_id
        left join sz_receivable_plan r on od.ord_id=r.ord_id
        left join product p on od.product_id=p.product_id
        left join sz_deliver d on od.ord_id=d.ord_id
        where s.ord_id=#{ordId}
    </select>
    <!--发货查订单-->
    <select id="ordANDdel">

    </select>
    <!--单条-->
    <select id="getszOrder" resultMap="szOrderResult">
        SELECT * FROM sz_order WHERE ord_id = #{ordId}
    </select>
    <!--增-->
    <insert id="addszOrder" parameterType="com.example.entity.request.SzOrder">
        <selectKey keyProperty="ordId" keyColumn="ord_id" resultType="Integer" order="AFTER">
            SELECT last_insert_id();
        </selectKey>
        insert into sz_order(ord_theme,ord_state,ord_head,ord_totalmoney,ord_starttime,ord_dealtime,ord_fahuotime,
        ord_huikuanmoney,ord_consignee,ord_province,ord_city,ord_country,ord_detail,ord_phone,ord_createtime,ord_delete,cus_id) VALUES
        (#{ordTheme},#{ordState},#{ordHead},#{ordTotalmoney},#{ordStarttime},#{ordDealtime},#{ordFahuotime},
        #{ordHuikuanmoney},#{ordConsignee},#{ordProvince},#{ordCity},#{ordCountry},#{ordDetail},#{ordPhone},#{ordCreatetime},#{ordDelete},#{cusId})
    </insert>
    <!--删-->
    <!--<delete id="delszOrder" parameterType="Integer">
        DELETE FROM sz_order WHERE ord_id = #{ordId}
    </delete>-->
    <update id="delszOrder" parameterType="Integer">
        UPDATE sz_order SET ord_delete = 1
        WHERE ord_id = #{ordId}
    </update>
    <!--改-->
    <update id="editszOrder" parameterType="SzOrder">
        update sz_order set ord_createtime = #{ordCreatetime}
        <if test="ordTheme !=null and ordTheme != ''">
            ,ord_theme = #{ordTheme}
        </if>
        <if test="ordHead !=null and ordHead != ''">
            ,ord_head = #{ordHead}
        </if>
        <if test="ordState !=null and ordState != ''">
            ,ord_state = #{ordState}
        </if>
        <if test="ordStarttime !=null and ordStarttime != ''">
            ,ord_starttime = #{ordStarttime}
        </if>
        where ord_id = #{ordId}
    </update>

    <select id="OrdANDDel" resultMap="szOrderResult">
        select * from sz_order where ord_state=1
    </select>
</mapper>